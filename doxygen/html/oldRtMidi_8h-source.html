<HTML>
<HEAD>
<TITLE>The Synthesis ToolKit in C++ (STK)</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER>
<img src="princeton.gif"> &nbsp; <img src="ccrma.gif"><P>
<a class="qindex" href="index.html">Home</a> &nbsp; <a class="qindex" href="information.html">Information</a> &nbsp; <a class="qindex" href="classes.html">Classes</a> &nbsp; <a class="qindex" href="download.html">Download</a> &nbsp; <a class="qindex" href="usage.html">Usage</a> &nbsp; <a class="qindex" href="maillist.html">Mail List</a> &nbsp; <a class="qindex" href="system.html">Requirements</a> &nbsp; <a class="qindex" href="links.html">Links</a> &nbsp; <a class="qindex" href="tutorial.html">Tutorial</a></CENTER>
<HR>
<!-- Generated by Doxygen 1.3-rc3 -->
<h1>oldRtMidi.h</h1><div class="fragment"><pre>00001 <span class="comment">/**********************************************************************/</span>
00011 <span class="comment">/**********************************************************************/</span>
00012 
00013 <span class="preprocessor">#ifndef RTMIDI_H</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#define RTMIDI_H</span>
00015 <span class="preprocessor"></span>
00016 <span class="preprocessor">#include &lt;vector&gt;</span>
00017 <span class="preprocessor">#include &lt;string&gt;</span>
00018 <span class="preprocessor">#include "RtError.h"</span>
00019 
00020 <span class="comment">// Operating system dependent thread functionality.</span>
00021 <span class="preprocessor">#if defined(__WINDOWS_DS__) || defined(__WINDOWS_ASIO__)</span>
00022 <span class="preprocessor"></span><span class="preprocessor">  #include &lt;windows.h&gt;</span>
00023 <span class="preprocessor">  #include &lt;process.h&gt;</span>
00024 
00025   <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ThreadHandle;
00026   <span class="keyword">typedef</span> CRITICAL_SECTION Mutex;
00027 
00028 <span class="preprocessor">#else // Various unix flavors with pthread support.</span>
00029 <span class="preprocessor"></span><span class="preprocessor">  #include &lt;pthread.h&gt;</span>
00030 
00031   <span class="keyword">typedef</span> pthread_t ThreadHandle;
00032   <span class="keyword">typedef</span> pthread_mutex_t Mutex;
00033 
00034 <span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>
00036 <span class="comment">// OS-X CoreMIDI header files.</span>
00037 <span class="preprocessor">#include &lt;CoreMIDI/CoreMIDI.h&gt;</span>
00038 <span class="preprocessor">#include &lt;CoreAudio/HostTime.h&gt;</span>
00039 
00040 <span class="comment">// Set the size of the circular MIDI input message buffer.</span>
00041 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMessages = 100;
00042 
00043 <span class="keyword">class </span><a class="code" href="classRtMidi.html">RtMidi</a>
00044 {
00045  <span class="keyword">public</span>:
00046 
00047   <span class="comment">// A MIDI message structure.  Each message represents one and only</span>
00048   <span class="comment">// one MIDI message.  Given the variable length of the bytes member,</span>
00049   <span class="comment">// this structure can contain sysex messages of arbitrary length.</span>
00050   <span class="keyword">struct </span>MidiMessage { 
00051     std::vector&lt;unsigned char&gt; bytes; 
00052     <span class="keywordtype">double</span> timeStamp;
00053 
00054     <span class="comment">// Default constructor.</span>
00055     MidiMessage()
00056       :bytes(3), timeStamp(0.0) {}
00057   };
00058 
00059   <span class="comment">// Defined MIDI port types.</span>
00060   <span class="keyword">enum</span> <a class="code" href="classRtMidi.html#s8">PortType</a> { MIDI_INPUT, MIDI_OUTPUT };
00061 
00062   <span class="comment">// Defined MIDI time stamp types.  Times are saved in a</span>
00063   <span class="comment">// double-precision floating-point variable.  Delta time is in</span>
00064   <span class="comment">// seconds (between events).  Absolute time is in seconds since</span>
00065   <span class="comment">// midnight (0 hour), January 1, 1970.</span>
00066   <span class="keyword">enum</span> TimeType { DELTA_TIME, ABSOLUTE_TIME };
00067 
00068   <span class="comment">// User callback function type definition.</span>
00069   <span class="keyword">typedef</span> void (*RtMidiCallback)( MidiMessage *message, <span class="keywordtype">void</span> *userData);
00070 
00071   <span class="comment">// Default constructor.</span>
00072   <a class="code" href="classRtMidi.html#a0">RtMidi</a>( TimeType time = DELTA_TIME );
00073 
00074   <span class="comment">// An overloaded constructor which can be used to open a MIDI port</span>
00075   <span class="comment">// during instantiation.  An exception is thrown if an error occurs</span>
00076   <span class="comment">// while attempting to make the port connection.</span>
00077   <a class="code" href="classRtMidi.html#a0">RtMidi</a>( PortType type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> portNumber = 0, TimeType time = DELTA_TIME );
00078 
00079   <span class="comment">// The destructor closes any open MIDI connections.</span>
00080   <a class="code" href="classRtMidi.html#a2">~RtMidi</a>();
00081 
00082   <span class="comment">// Open a MIDI connection of the specified type.  An optional port</span>
00083   <span class="comment">// number greater than 0 can be specified.  Otherwise, the default</span>
00084   <span class="comment">// or first port found is opened.  An exception is thrown if an</span>
00085   <span class="comment">// error occurs while attempting to make the port connection.</span>
00086   <span class="keywordtype">void</span> <a class="code" href="classRtMidi.html#a3">openPort</a>( PortType type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> portNumber = 0 );
00087 
00088   <span class="comment">// Close an open MIDI connection (if one exists).</span>
00089   <span class="keywordtype">void</span> <a class="code" href="classRtMidi.html#a4">closePort</a>( <span class="keywordtype">void</span> );
00090 
00091   <span class="comment">// Return the number of available MIDI ports of the specified type.</span>
00092   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classRtMidi.html#a5">getPortCount</a>( PortType type );
00093 
00094   <span class="comment">// Return a string identifier for the specified MIDI port type and number.</span>
00095   std::string <a class="code" href="classRtMidi.html#a6">getPortName</a>( PortType type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> portNumber );
00096 
00097   <span class="comment">// Set a user-defined callback function for notification of Midi input.</span>
00098   <span class="keywordtype">void</span> <a class="code" href="classRtMidi.html#a7">setInputCallback</a>( RtMidiCallback callback, <span class="keywordtype">void</span> *userData);
00099 
00100   <span class="comment">// Return a reference to a vector containing the next available</span>
00101   <span class="comment">// incoming MIDI message.  This function returns immediately whether</span>
00102   <span class="comment">// a new message is available or not.  A valid message is indicated</span>
00103   <span class="comment">// by a non-zero vector size in the MidiMessage structure.  An</span>
00104   <span class="comment">// exception is thrown if an error occurs during message retrieval</span>
00105   <span class="comment">// or an input connection was not previously established.</span>
00106   <span class="keyword">const</span> RtMidi::MidiMessage *<a class="code" href="classRtMidi.html#a10">getMessage</a>( <span class="keywordtype">void</span> );
00107 
00108   <span class="comment">// Send a single message out an open MIDI port.  If the message time</span>
00109   <span class="comment">// stamp is non-zero, the message will be scheduled for output</span>
00110   <span class="comment">// accordingly.  Otherwise, it will be output immediately.  An</span>
00111   <span class="comment">// exception is thrown if an error occurs during output or an output</span>
00112   <span class="comment">// connection was not previously established.</span>
00113   <span class="keywordtype">bool</span> <a class="code" href="classRtMidi.html#a11">sendMessage</a>( <span class="keyword">const</span> MidiMessage *message );
00114 
00115   <span class="comment">// This public structure is used to pass private class data to the</span>
00116   <span class="comment">// MIDI input callback function or thread.</span>
00117   <span class="keyword">struct </span>RtMidiCallbackInfo {
00118     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> writeIndex;
00119     <span class="keywordtype">bool</span> doDeltaTime;
00120     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lastTime;
00121     MidiMessage buffer[nMessages];
00122     Mutex mutex;
00123     <span class="keywordtype">bool</span> usingCallback;
00124     <span class="keywordtype">void</span> *userCallback;
00125     <span class="keywordtype">void</span> *userData;
00126 
00127     <span class="comment">// Default constructor.</span>
00128     RtMidiCallbackInfo()
00129       : writeIndex(0), doDeltaTime(true), lastTime(0),
00130          usingCallback(false), userCallback(0), userData(0) {}
00131   };
00132 
00133  <span class="keyword">private</span>:
00134 
00135   <span class="comment">// A basic error reporting function for internal use in the RtMidi</span>
00136   <span class="comment">// class.  The behavior of this function can be modified to suit</span>
00137   <span class="comment">// specific needs.</span>
00138   <span class="keywordtype">void</span> error( RtError::Type type );
00139   
00140   MidiMessage currentMessage_;
00141   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> readIndex_;
00142   MIDIClientRef client_;
00143   MIDIPortRef port_;
00144   MIDIEndpointRef destinationId_;
00145   RtMidiCallbackInfo callbackInfo_;
00146   <span class="keywordtype">bool</span> connected_;
00147   <span class="keywordtype">bool</span> isInputPort_;
00148   std::string errorString_;
00149 
00150 };
00151 
00152 <span class="preprocessor">#endif</span>
</pre></div><HR>

<table>
  <tr><td><A HREF="http://www-ccrma.stanford.edu/software/stk/"><I>The Synthesis ToolKit in C++ (STK)</I></A></td></tr>
  <tr><td>&copy;1995-2002 Perry R. Cook and Gary P. Scavone. All Rights Reserved.</td></tr>
</table>

</BODY>
</HTML>
